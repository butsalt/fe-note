<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>learn</title>
<style type="text/css">
	*{
		margin:0;
		padding:0;
	}
	html,body{
		height:100%;
	}
	body{
		display:flex;
		align-items:center;
		justify-content:center;
	}
	#cnt{
		position:relative;
	}
	.card:nth-child(2n+1){
		background-color:#CC99CC;
	}
	div{
		-webkit-user-select:none;
	}
</style>
<script type="text/javascript" src="../scripts/dd.js"></script>
<script type="text/javascript" src="../scripts/Tween.js"></script>
<script type="text/javascript" src="../scripts/jquery-2.1.3.js"></script>
<script type="text/javascript">
	var height = 125;
	var width = 250;
	function getPos(el,e){
		return {
			y:e.pageY,
			top:dd.trimPx(el.top())
		};
	}
	function getTops(group){
		var tops = [];
		var heights = [];
		var even = group.length%2==0;
		for(var i=0;i<group.length;i++){
			heights.push(group[i].dom.getBoundingClientRect().height);
		}
		for(var i=0;i<group.length;i++){
			var top = 0;
			for(var j=0;j<i;j++){
				top += heights[j];
			}
			if(even!==(i%2==0)){
				top += heights[i] - height;
			}
			tops.push(top);
		}
		return tops;
	}
	$(function(){
		var cnt = $('#cnt');
		var max = 0;
		
		var group = [];
		for(var i=0;i<5;i++){
			var el = dd.el();
			el.absolute().top(height*group.length+'px').width(width+'px').height(height+'px');
			if(i%2==0){
				el.css('background-color','#999');
			}else{
				el.css('background-color','#ccc');
			}
			cnt.append(el.dom);
			group.push(el);
		}
		var change = true;
		for(var i=group.length-1;i>=0;i--){
			var el = group[i];
			if(change){
				el.css('transform-origin','bottom');
			}else{
				el.css('transform-origin','top');
			}
			change = !change;
		}
		
		var dragEl = dd.el().width(width+'px').height(80+'px').css('background-color','#444').css('color','#ccc').html('Drag me!');
		dragEl.css('line-height','80px').css('text-align','center').css('cursor','pointer');
		max = height*group.length;
		dragEl.absolute().top(max+'px');
		dragEl.css('border-bottom-left-radius','7px');
		dragEl.css('border-bottom-right-radius','7px');
		dragEl.on('mousedown',function(e){
			var pos = getPos(dragEl,e);
			var d = dd.el(document.body);
			d.on('mousemove',function(e){
				var curPos = getPos(dragEl,e);
				var curTop = Math.max(0,Math.min(pos.top+curPos.y-pos.y,max));
				dragEl.top(curTop+'px');
				var rotate = (1-curTop/max)*90;
				var change = true;
				for(var i=group.length-1;i>=0;i--){
					var el = group[i];
					if(change){
						el.css('-webkit-transform','perspective(300px) rotateX('+rotate+'deg)');
					}else{
						el.css('-webkit-transform','perspective(300px) rotateX(-'+rotate+'deg)');
					}
					change = !change;
				}
				getTops(group).forEach(function(top,i){
					group[i].top(top+'px');
				});
			});
			d.on('mouseup',function(){
				d.un('mousemove');
				d.un('mouseup');
			});
		});
		cnt.append(dragEl.dom);
		
		
		cnt.height(height*group.length+80+'px');
		cnt.width(width);
		
		function render(time){
			requestAnimationFrame(render);
			TWEEN.update(time);
		};
		
		requestAnimationFrame(render);
	});
</script>
</head>
<body>
	<div id='cnt'>
	</div>
</body>
</html>